// ...existing code...
<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>OAuth Callback</title>
  <style>
    body{font-family: Arial, sans-serif;padding:24px;background:#f7f7fb}
    pre{background:#fff;padding:12px;border-radius:6px;box-shadow:0 1px 6px rgba(0,0,0,.05);overflow:auto}
    button{margin-top:8px}
  </style>
</head>
<body>
  <h2>OAuth Callback</h2>
  <div>
    <p>Token (from query):</p>
    <pre id="token">No token</pre>
    <button id="copyBtn">Copy token</button>
  </div>
  <hr/>
  <div>
    <p>User info (fetched from /api/auth/current_user):</p>
    <pre id="user">No user</pre>
    <button id="fetchUser">Fetch user with token</button>
  </div>

  <script>
    function qs() {
      const s = {};
      location.search.replace(/^\?/, '').split('&').forEach(pair => {
        if (!pair) return;
        const [k,v] = pair.split('=');
        s[decodeURIComponent(k)] = decodeURIComponent(v || '');
      });
      return s;
    }

    const params = qs();
    const token = params.token || params.access_token || '';
    const tokenEl = document.getElementById('token');
    tokenEl.textContent = token || 'No token in query';

    document.getElementById('copyBtn').addEventListener('click', () => {
      if (!token) return alert('No token to copy');
      navigator.clipboard.writeText(token).then(()=>alert('Copied'));
    });

    document.getElementById('fetchUser').addEventListener('click', async () => {
      if (!token) return alert('No token available');
      try {
        const res = await fetch('/api/auth/current_user', {
          headers: { Authorization: 'Bearer ' + token }
        });
        const body = await res.json();
        document.getElementById('user').textContent = JSON.stringify(body, null, 2);
      } catch (err) {
        document.getElementById('user').textContent = 'Fetch error: ' + err;
      }
    });
  </script>
</body>
</html>
// ...existing code...